<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question & Answer</title>
    <link href="/css/bootstrap.rtl.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/materialdesignicons.min.css">
    <link href="/css/style.css" rel="stylesheet" />
</head>

<body>
    <div class="container">
        <main role="main" class="pb-3">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="card" id="gameArea">
                        <div class="card-header">
                            <p id="questionBox">به چالش سوالات فوتبالی خوش آمدید</p>
                            <p id="icon" class="text-center"><i class="mdi mdi-emoticon-wink-outline mdi-36px"></i></p>
                        </div>
                        <div class="card-body">
                            <div id="answerBox">
                            </div>
                            <button class="btn btn-success form-control">شروع</button>
                        </div>
                        <div class="card-footer d-flex justify-content-between">
                            <div id="timeBox" class="d-flex justify-content-center">
                                <p id="second">00</p>
                                <p>:</p>
                                <p id="minute">00</p>
                            </div>
                            <p id="questionNumber"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div id="scoreBox">
                <p id="notAnswered"></p>
                <p id="answerTrue"></p>
                <p id="answerFalse"></p>
                <div id="score"></div>
            </div>
        </main>
    </div>
    <script>

    </script>
    <script src="/js/bootstrap.bundle.min.js"></script>


    <script>
        fetch("/data.json").then(response => response.json()).then(json => {
            const questionBox = document.getElementById('questionBox');
            const answerBox = document.getElementById('answerBox');
            const button = document.querySelector('button');
            const time = document.getElementById('timeBox');
            const questionNumber = document.getElementById('questionNumber');
            const scoreBox = document.getElementById('scoreBox');
            const scoreBoxNot = document.getElementById('notAnswered');
            const scoreBoxTrue = document.getElementById('answerTrue');
            const scoreBoxFlase = document.getElementById('answerFalse');
            const dscore = document.getElementById('score');
            const icon = document.getElementById("icon");
            var intervall;
            var small;
            var answerFalse = 0;
            var answerTrue = 0;
            var notAnswered = 0;
            var score = 0;
            var x = 1;
            var clickCount = 0;
            var randomQuestion;
            var answerRadio;
            var timeout;
            button.addEventListener('click', playGame);
            function createQuestion() {
                randomQuestion = Math.floor(Math.random() * json.length);
                questionBox.innerHTML = json[randomQuestion].question;
                for (var i = 0; i < 4; i++) {
                    var output = '<input type="radio" name="Answer" value="';
                    output += json[randomQuestion].Answers[i];
                    output += '"/>'
                    output += "<small>" + json[randomQuestion].Answers[i] + "</small>";
                    output += "</br>";
                    answerBox.innerHTML += output;
                }
            }
            // function notAnsweredUser() {
            //     timeout = setTimeout(function () {
            //         answerRadio = document.querySelector('[name=Answer]:checked');
            //         if (answerRadio === null) {
            //             questionBox.style.color = "blue";
            //             notAnswered++;
            //             small = document.querySelectorAll('small');
            //             for (p = 0; p < small.length; p++) {
            //                 if (small[p].innerHTML == json[randomQuestion].trueAnswer) {
            //                     small[p].style.color = "green"
            //                 } else {
            //                     small[p].style.color = "red"
            //                 }
            //             }
            //             setTimeout(playGame, 1000);
            //         }
            //         json.splice(randomQuestion, 1);
            //     }, 2000);
            // }
            function checkAnswer() {
                answerRadio = document.querySelector('[name=Answer]:checked');
                if (answerRadio === null) {
                    questionBox.style.color = "blue";
                    notAnswered++;
                    small = document.querySelectorAll('small');
                    for (p = 0; p < small.length; p++) {
                        if (small[p].innerHTML == json[randomQuestion].trueAnswer) {
                            small[p].style.color = "green"
                        } else {
                            small[p].style.color = "red"
                        }
                    }
                    setTimeout(playGame, 1000);
                }
                else if (answerRadio.value == json[randomQuestion].trueAnswer) {
                    questionBox.style.color = "green";
                    answerTrue++;
                    score++;
                    small = document.querySelectorAll('small');
                    for (p = 0; p < small.length; p++) {
                        if (small[p].innerHTML == json[randomQuestion].trueAnswer) {
                            small[p].style.color = "green"
                        }
                    }
                    setTimeout(playGame, 1000);
                } else {
                    questionBox.style.color = "red";
                    answerFalse++;
                    small = document.querySelectorAll('small');
                    for (p = 0; p < small.length; p++) {
                        if (small[p].innerHTML == json[randomQuestion].trueAnswer) {
                            small[p].style.color = "green"
                        } else {
                            small[p].style.color = "red"
                        }
                    }
                    setTimeout(playGame, 1000);
                }
                json.splice(randomQuestion, 1);
            }
            function playGame() {
                icon.style.display = "none";
                questionBox.style.color = "";
                button.innerHTML = "ثبت پاسخ";
                answerBox.innerHTML = "";
                var check = setTimeout(checkAnswer, 2000);
                if (x <= 20) {
                    questionBox.style.display = "block";
                    questionNumber.innerHTML = x + "/20";
                    x++;
                    createQuestion();
                } else {
                    clearTimeout(timeout);
                    clearInterval(intervall);
                    clearTimeout(check);
                    questionBox.innerHTML = "پایان سوالات . موفق باشید";
                    answerBox.style.display = "none";
                    button.style.display = "none";
                    dscore.innerHTML = "امتیاز شما در این بازی :" + score;
                    if (score <= 10) {
                        dscore.style.color = "red";
                    } else if (score <= 15) {
                        dscore.style.color = "blue"
                    } else {
                        dscore.style.color = "green";
                    }
                    scoreBox.style.display = "block";
                    scoreBoxNot.innerHTML = " سوالاتی که پاسخ نداده اید :" + notAnswered + "<br>";
                    scoreBoxTrue.innerHTML += " سوالاتی که صحیح پاسخ داده اید : " + answerTrue + "<br>";
                    scoreBoxFlase.innerHTML += " سوالاتی که اشتباه پاسخ داده اید : " + answerFalse;
                }
                if (clickCount < 1) {
                    intervall = setInterval(timer, 1000);
                }
                clickCount++;
            }



            function timer() {
                var minute = document.getElementById('minute').innerText;
                var second = document.getElementById('second').innerText;
                var timeBox = document.getElementById('timeBox');
                if (parseInt(minute) >= 20) {
                    timeBox.style.color = "red";
                    clearInterval(intervall);
                }
                if (parseInt(second) === 59) {
                    var newMin = (parseInt(minute) + 1).toString();
                    if (newMin < 10) {
                        newMin = "0" + newMin;
                    }
                    document.getElementById('minute').innerHTML = newMin
                    document.getElementById('second').innerHTML = "00";
                } else {
                    var newSec = (parseInt(second) + 1).toString();
                    if (newSec < 10) {
                        newSec = "0" + newSec;
                    }
                    document.getElementById('second').innerHTML = newSec;
                }
            }

        });
    </script>

</body>

</html>